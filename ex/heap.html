<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta description="堆排序" />
    <meta keyword="数据结构 堆排序 最大顶堆 可视化 演示" />
    <title>堆排序 - 数据结构演示</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=EDGE" />
    <link rel="icon" type="image/png" href="../../img/favicon.png" />
    <link rel="stylesheet" href="css/stylesheet.css" />
    <link rel="stylesheet" href="css/common.css" />
    <link rel="stylesheet" href="css/viz.css" />
    <link rel="stylesheet" href="css/visual.css" />
    <link rel="stylesheet" href="css/drawgraph.css" />
    <script>
      (function (i, s, o, g, r, a, m) {
        i["GoogleAnalyticsObject"] = r;
        (i[r] =
          i[r] ||
          function () {
            (i[r].q = i[r].q || []).push(arguments);
          }),
          (i[r].l = 1 * new Date());
        (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m);
      })(
        window,
        document,
        "script",
        "http://www.google-analytics.com/analytics.js",
        "ga"
      );

      ga("create", "UA-1566631-4", "auto");
      ga("send", "pageview");

      function changeURL() {
        var x = document.getElementById("Language").selectedIndex;
        var y = document.getElementById("Language").options;
        window.location.assign("http://" + y[x].text + ".visualgo.net/heap");
      }
    </script>
    <style>
      .buildv1 {
        bottom: 146px;
      }

      #buildv1-input input {
        width: 200px;
        padding: 8px 8px 7px;
      }

      #buildv1-go p {
        padding: 8px 8px 7px;
      }

      #buildv1-sample p {
        padding: 8px 8px 7px;
      }

      #buildv1-random p {
        padding: 8px 8px 7px;
      }

      #buildv1-err {
        padding: 8px 0px 7px;
      }

      .insert {
        bottom: 119px;
      }

      #insert-input input {
        width: 25px;
        padding: 6px 8px 5px;
      }

      #insert-go p {
        padding: 5px 8px;
      }

      #insert-err {
        padding: 5px 0px;
      }

      .extractmax {
        bottom: 92px;
      }

      #extractmax-err {
        padding: 5px 0px;
      }

      .heapsort {
        bottom: 60px;
      }

      #heapsort-err {
        padding: 8px 0px 7px;
      }
    </style>
  </head>

  <body>
    <div id="top-bar">
      <a id="home" href="../index.html">
        数据结构
        <span class="colour" style="color: rgb(75, 101, 186);">
          演示平台
        </span> </a
      >&nbsp;&nbsp;&nbsp;
      <span id="title">
        <a id="title-Bubble" href="../sorting.html#type=Bubble">冒泡</a>
        <a id="title-Selection" href="../sorting.html#type=Selection">选择</a>
        <a id="title-Insertion" href="../sorting.html#type=Insertion">插入</a>
        <a id="title-Merge" href="../sorting.html#type=Merge">归并</a>
        <a id="title-Quick" href="../sorting.html#type=Quick">快速</a>
        <a id="title-Shell" href="../sorting.html#type=Shell">希尔</a>
        <a id="title-heap" class="selected-viz">堆排序</a>
      </span>
    </div>
    <div id="viz"></div>
    <div id="current-action" class="panel">
      <p></p>
    </div>
    <div id="actions" class="panel">
      <p id="buildv1">创建</p>
      <p id="insert">插入</p>
      <p id="extractmax" class="execAction" onclick="extractmax()">
        取出最大值
      </p>
      <p id="heapsort" class="execAction" onclick="heapsort()">堆排序</p>
    </div>
    <div id="actions-hide" class="panel-hide">
      <img src="img/arrow_white_right.png" title="show/hide actions panel" />
    </div>
    <div id="actions-extras">
      <div class="buildv1 action-menu-pullout">
        <div id="buildv1-input" class="new-menu-option">
          <input
            type="text"
            id="arrv1"
            autocomplete="off"
            value="2,7,26,25,19,17,1,90,3,36"
          />
        </div>
        <div
          id="buildv1-go"
          class="execAction coloured-menu-option"
          onclick="buildv1()"
        >
          <p>开始</p>
        </div>
        <div
          id="buildv1-sample"
          class="execAction new-menu-option coloured-menu-option"
          onclick="buildv1Sample()"
        >
          <p>顺序</p>
        </div>
        <div
          id="buildv1-random"
          class="execAction new-menu-option coloured-menu-option"
          onclick="buildv1Random()"
        >
          <p>随机</p>
        </div>
        <div id="buildv1-err" class="err"></div>
      </div>
      <div class="insert action-menu-pullout">
        <div id="insert-input" class="new-menu-option">
          <input type="text" id="v" autocomplete="off" value="26" />
        </div>
        <div
          id="insert-go"
          class="execAction coloured-menu-option"
          onclick="insert()"
        >
          <p>开始</p>
        </div>
        <div id="insert-err" class="err"></div>
      </div>
      <div class="extractmax action-menu-pullout">
        <div id="extractmax-err" class="err"></div>
      </div>
      <div class="heapsort action-menu-pullout">
        <div id="heapsort-err" class="err"></div>
      </div>
    </div>
    <div id="status" class="panel">
      <p></p>
    </div>
    <div id="status-hide" class="panel-hide">
      <img src="img/arrow_white_right.png" title="show/hide status panel" />
    </div>
    <div id="codetrace" class="panel">
      <p id="code1" style="padding-top: 10px;"></p>
      <p id="code2"></p>
      <p id="code3"></p>
      <p id="code4"></p>
      <p id="code5"></p>
      <p id="code6"></p>
      <p id="code7" style="padding-bottom: 10px;"></p>
    </div>
    <div id="codetrace-hide" class="panel-hide">
      <img src="img/arrow_white_right.png" title="show/hide codetrace panel" />
    </div>
    <div id="left-bar"></div>
    <div id="right-bar"></div>
    <div id="bottom-bar">
      <a id="trigger-about">关于</a>
      <a id="trigger-team">团队</a>
    </div>
    <div id="media-controls">
      <div id="speed-control">
        慢
        <div id="speed-input"></div>
        快
      </div>
      <span
        id="go-to-beginning"
        class="media-control-button"
        title="go to beginning"
        onclick="goToBeginning()"
        ><img src="img/goToBeginning.png" alt="go to beginning"
      /></span>
      <span
        id="previous"
        class="media-control-button"
        title="step backward"
        onclick="stepBackward()"
        ><img src="img/prevFrame.png" alt="previous frame"
      /></span>
      <span
        id="pause"
        class="media-control-button"
        title="pause"
        onclick="pause()"
        ><img src="img/pause.png" alt="pause"
      /></span>
      <span id="play" class="media-control-button" title="play" onclick="play()"
        ><img src="img/play.png" alt="play"
      /></span>
      <span
        id="next"
        class="media-control-button"
        title="step forward"
        onclick="stepForward()"
        ><img src="img/nextFrame.png" alt="next frame"
      /></span>
      <span
        id="go-to-end"
        class="media-control-button"
        title="go to end"
        onclick="goToEnd()"
        ><img src="img/goToEnd.png" alt="go to end"
      /></span>
      <div id="progress-bar" class="media-control-button"></div>
    </div>
    <div id="dark-overlay"></div>
    <div id="about" class="overlays">
      <h4>关于</h4>
      <span class="close-overlay">&#x2715;</span>
      <div class="content"></div>
    </div>
    <div id="team" class="overlays">
      <h4>团队</h4>
      <span class="close-overlay">&#x2715;</span>
      <div class="content"></div>
    </div>

    <script src="js/jquery-2.2.2.min.js"></script>
    <script src="js/jquery-ui.min.js"></script>
    <script src="js/d3.min.js"></script>
    <script src="js/viz.js"></script>
    <script src="js/common.js"></script>
    <script src="js/constant.js"></script>
    <script src="js/properties.js"></script>
    <script src="js/helperObjects.js"></script>
    <script src="js/misc.js"></script>
    <script src="js/Widget.js"></script>
    <script src="js/GraphWidget.js"></script>
    <script src="js/GraphVertexWidget.js"></script>
    <script src="js/GraphEdgeWidget.js"></script>
    <script src="js/drawgraph.js"></script>
    <script src="js/jquery.cookie.js"></script>
    <script type="text/javascript">
      var Heap = function () {
        var self = this;
        var graphWidget = new GraphWidget();

        /*
         * A: Internal representation of Heap in this object
         * It is a compact 1-based 1-dimensional array (ignoring index 0).
         * The parent/left child/right child can be computed via index manipulation.
         *
         * Elements of A are ObjectPair objects, where first element is the value and the second element is the ID of the vertex SVG corresponding to the value
         */

        /*
         * Edge IDs are the index of the child element, so for example edge A[1]-A[2] will have ID "e2" (edge 2)
         * The edges will be set to not change when vertexes are interchanged
         * This eliminates the need to maintain an Adjacency Matrix / List
         */

        var coord = new Array();
        var A = new Array();
        var amountVertex = 0;

        dummyInitArrayOne();
        init();

        clearScreen();

        dummyInitArrayTwo();
        init();

        var stateList = [];

        this.getGraphWidget = function () {
          return graphWidget;
        };

        function parent(i) {
          return i >> 1;
        } // Math.floor(i/2); }

        function left(i) {
          return i << 1;
        } // i*2;

        function right(i) {
          return (i << 1) + 1;
        } // i*2+1;

        this.IsMaxHeap = function (array) {
          for (var i = 1; i < array.length; i++)
            if (array[parent(i)] < array[i]) return false;
          return true;
        };

        this.generate = function (array) {
          clearScreen();
          array.unshift(999999);
          A = [];
          for (var i = 0; i < array.length; i++) {
            A[i] = new ObjectPair(array[i], amountVertex); // testing layout, to leave the edges there for now
            amountVertex++;
          }
          init();
        };

        function dummyInitArrayOne() {
          for (var i = 1; i <= 31; i++) {
            A[i] = new ObjectPair(31 - i, amountVertex);
            amountVertex++;
          }
        }

        function dummyInitArrayTwo() {
          var initValue = [999999, 90, 19, 36, 17, 3, 25, 1, 2, 7]; // set a huge number A[0] to prevent minor bug
          A = [];

          for (var i = 0; i < initValue.length; i++) {
            A[i] = new ObjectPair(initValue[i], amountVertex);
            amountVertex++;
          }
        }

        function init() {
          var i, j;

          // compute vertex coordinates
          var vtx_count = 1; // 1-based indexing
          for (i = 0; i <= 4; i++) {
            // we limit our visualization to 4 levels only
            var entriesInThisLevel = 1 << i; // 2^i
            for (j = 0; j < entriesInThisLevel; j++) {
              coord[vtx_count] = new Array();
              coord[vtx_count][0] =
                ((2 * j + 1) * 900) / (2 * entriesInThisLevel); // x Coordinate
              coord[vtx_count][1] = 50 + 40 * i; // y Coordinate
              vtx_count++;
            }
          }

          for (
            i = 1;
            i < A.length;
            i++ // add vertices first
          )
            graphWidget.addVertex(
              coord[i][0],
              coord[i][1],
              A[i].getFirst(),
              A[i].getSecond(),
              true,
              i
            );

          for (i = 2; i < A.length; i++) {
            // then add edges, i is edge id
            parentVertex = A[parent(i)].getSecond();
            childVertex = A[i].getSecond();
            graphWidget.addEdge(
              parentVertex,
              childVertex,
              i,
              EDGE_TYPE_UDE,
              1,
              true
            );
          }
        }

        function clearScreen() {
          var i;
          for (
            i = 2;
            i < A.length;
            i++ // remove edges first
          )
            graphWidget.removeEdge(i);
          for (
            i = 1;
            i < A.length;
            i++ // then afterwards, remove vertices
          )
            graphWidget.removeVertex(A[i].getSecond());
          amountVertex = 0;
        }

        this.insert = function (vertexText, startAnimationDirectly) {
          if (A.length > 31) {
            $("#insert-err").html("错误，最大容量为31");
            return false;
          }

          for (i = 0; i < A.length; i++) {
            if (A[i].getFirst() == parseInt(vertexText)) {
              $("#insert-err").html("错误，该数字已存在");
              return false;
            }
          }

          if (startAnimationDirectly == true) {
            stateList = [];
            populatePseudocode(0);
          }

          var i, key, cs;
          if (A.length > 1) {
            cs = createState(A);
            cs["status"] = "当前二叉堆";
            cs["lineNo"] = !startAnimationDirectly ? 2 : 0;
            stateList.push(cs); // zero-th frame, the starting point
          }

          A[A.length] = new ObjectPair(parseInt(vertexText), amountVertex);
          amountVertex++;
          i = A.length - 1;

          cs = createState(A);
          cs["vl"][A[i].getSecond()]["state"] = VERTEX_HIGHLIGHTED;
          cs["status"] = "将 " + vertexText + " 插入到堆";
          cs["lineNo"] = !startAnimationDirectly ? 3 : [1, 2]; // differentiate O(N log N) build vs single insert
          stateList.push(cs); // first frame, highlight the newly inserted vertex

          while (i > 1 && A[parent(i)].getFirst() < A[i].getFirst()) {
            cs = createState(A);
            cs["vl"][A[i].getSecond()]["state"] = VERTEX_HIGHLIGHTED;
            cs["vl"][A[parent(i)].getSecond()]["state"] = VERTEX_TRAVERSED;
            cs["status"] =
              A[parent(i)].getFirst() + " < " + A[i].getFirst() + ", 交换";
            cs["lineNo"] = 3;
            stateList.push(cs); // before swap

            var temp = A[i];
            A[i] = A[parent(i)];
            A[parent(i)] = temp;
            cs = createState(A);
            cs["vl"][A[i].getSecond()]["state"] = VERTEX_TRAVERSED;
            cs["vl"][A[parent(i)].getSecond()]["state"] = VERTEX_HIGHLIGHTED;
            cs["status"] =
              A[parent(i)].getFirst() + " <-> " + A[i].getFirst() + " 已交换.";
            cs["lineNo"] = !startAnimationDirectly ? 3 : 4;
            stateList.push(cs); // record the successive vertex swap animation
            i = parent(i);
          }

          cs = createState(A); // record the final state of the heap after insertion to stop the highlights
          cs["vl"][A[i].getSecond()]["state"] = VERTEX_HIGHLIGHTED; // highlighted the successful insertion
          cs["status"] = vertexText + " 已成功插入.";
          cs["lineNo"] = !startAnimationDirectly ? 3 : 0;
          stateList.push(cs);

          if (startAnimationDirectly) graphWidget.startAnimation(stateList);
          return true;
        };

        this.shiftDown = function (i, calledFrom) {
          while (i < A.length) {
            var maxV = A[i].getFirst(),
              max_id = i;
            if (left(i) < A.length && maxV < A[left(i)].getFirst()) {
              maxV = A[left(i)].getFirst();
              max_id = left(i);
            }
            if (right(i) < A.length && maxV < A[right(i)].getFirst()) {
              maxV = A[right(i)].getFirst();
              max_id = right(i);
            }

            if (max_id != i) {
              var cs = createState(A);
              cs["vl"][A[i].getSecond()]["state"] = VERTEX_HIGHLIGHTED;
              cs["vl"][A[max_id].getSecond()]["state"] = VERTEX_TRAVERSED;
              cs["status"] =
                A[i].getFirst() + " < " + A[max_id].getFirst() + ", 交换";
              if (calledFrom == "extractmax") cs["lineNo"] = [4, 5];
              else if (calledFrom == "buildv2") cs["lineNo"] = [2, 3];
              else if (calledFrom == "heapsort") cs["lineNo"] = 2;
              stateList.push(cs); // deal with affected edges first

              var temp = A[i];
              A[i] = A[max_id];
              A[max_id] = temp;
              cs = createState(A);
              cs["status"] =
                A[i].getFirst() + " <-> " + A[max_id].getFirst() + " 已交换";
              if (calledFrom == "extractmax") cs["lineNo"] = 6;
              else if (calledFrom == "buildv2") cs["lineNo"] = [2, 3];
              else if (calledFrom == "heapsort") cs["lineNo"] = 2;
              stateList.push(cs);

              i = max_id;
            } else break;
          }
        };

        this.extractMax = function (startAnimationDirectly) {
          if (A.length == 2) {
            $("#extractmax-err").html("当前堆只有一个元素，该元素即为最大值");
            return false;
          }

          if (startAnimationDirectly == true) {
            stateList = [];
            populatePseudocode(1);
          }

          var cs = createState(A);
          cs["vl"][A[1].getSecond()]["state"] = VERTEX_HIGHLIGHTED;
          cs["status"] = "根节点存储最大值.";
          cs["lineNo"] = !startAnimationDirectly ? 2 : 0; // heapsort vs standard extract
          stateList.push(cs); // highlight the root (max element)

          cs = createState(A);
          delete cs["vl"][A[1].getSecond()];
          var maxitem = A[1].getFirst();
          cs["status"] = "取出根节点" + maxitem + ".";
          if (!startAnimationDirectly)
            // heapsort
            cs["lineNo"] = 2;
          else cs["lineNo"] = 1;
          stateList.push(cs); // move the root (max element) a bit upwards (to simulate 'extract max')

          if (A.length > 2) {
            cs = createState(A);
            delete cs["vl"][A[1].getSecond()];
            cs["status"] =
              "将根节点替换为最后一个叶节点 " +
              A[A.length - 1].getFirst() +
              ".";
            cs["vl"][A[A.length - 1].getSecond()]["state"] = VERTEX_HIGHLIGHTED; // highlighted the last leaf
            if (!startAnimationDirectly)
              // heapsort
              cs["lineNo"] = 2;
            else cs["lineNo"] = [2, 3];
            stateList.push(cs); // delete bottom-most right-most leaf (later, also remove its associated edge)
          }

          if (A.length > 2) {
            A[1] = A[A.length - 1];
            A.splice(A.length - 1, 1);
            cs = createState(A);
            cs["vl"][A[1].getSecond()]["state"] = VERTEX_HIGHLIGHTED;
            cs["status"] = "新的根节点";
            if (!startAnimationDirectly)
              // heapsort
              cs["lineNo"] = 2;
            else cs["lineNo"] = [2, 3];
            stateList.push(cs); // highlight the new root
          }

          if (!startAnimationDirectly)
            // heapsort
            this.shiftDown(1, "heapsort");
          else this.shiftDown(1, "extractmax");

          cs = createState(A);
          cs["status"] = "取出最大值已完成<br>获取的最大值为: " + maxitem;
          if (!startAnimationDirectly)
            // heapsort
            cs["lineNo"] = 1;
          else cs["lineNo"] = 0;
          stateList.push(cs);

          if (startAnimationDirectly) graphWidget.startAnimation(stateList);

          return true;
        };

        this.heapSort = function () {
          if (A.length == 2) {
            $("#heapsort-err").html("当前堆只有一个元素，不需要排序");
            return false;
          }

          populatePseudocode(2);
          res = []; // copy first
          for (var i = 1; i < A.length; i++) res[i - 1] = A[i].getFirst();
          res.sort(function (a, b) {
            return a - b;
          });

          stateList = [];
          var len = A.length - 1;
          var partial = [];
          for (var i = 0; i < len; i++) partial[i] = -1;

          for (var i = 0; i < len - 1; i++) {
            // except the last item (minor bug if not stopped here)
            partial[len - 1 - i] = A[1].getFirst();
            this.extractMax(false);
            cs = createState(A);
            cs["status"] = "当前序列为 " + partial;
            cs["lineNo"] = 1;
            stateList.push(cs);
          }

          cs = createState(A);
          cs["status"] = "最终序列为 " + res;
          cs["lineNo"] = 0;
          stateList.push(cs);

          graphWidget.startAnimation(stateList);
          return true;
        };

        this.buildV1 = function (arr) {
          if (arr.length > 31) {
            $("#buildv1-err").html("错误，最大容量为31");
            return false;
          }

          populatePseudocode(3);
          clearScreen();
          var i,
            initValue = [999999, parseInt(arr[0])];
          A = []; // destroy old A, create new one
          stateList = [];

          var cs = createState(A);
          cs["status"] = "新建一个空堆";
          cs["lineNo"] = 1;
          stateList.push(cs);

          for (i = 0; i < initValue.length; i++) {
            A[i] = new ObjectPair(initValue[i], amountVertex);
            amountVertex++;
          }
          init();

          cs = createState(A);
          cs["status"] = "插入 " + arr[0] + "作为新的根节点";
          cs["lineNo"] = [2, 3];
          stateList.push(cs);

          for (
            i = 1;
            i < arr.length;
            i++ // insert one by one
          )
            this.insert(parseInt(arr[i]), false);

          cs = createState(A);
          cs["status"] = "二叉堆创建完毕: " + arr + ".";
          cs["lineNo"] = 0;
          stateList.push(cs);

          graphWidget.startAnimation(stateList);
          return true;
        };

        function createState(internalHeapObject) {
          var state = {
            vl: {},
            el: {},
            status: {},
          };

          for (var i = 1; i < internalHeapObject.length; i++) {
            var key = internalHeapObject[i].getSecond();
            state["vl"][key] = {};
            state["vl"][key]["cx"] = coord[i][0];
            state["vl"][key]["cy"] = coord[i][1];
            state["vl"][key]["text"] = internalHeapObject[i].getFirst();
            state["vl"][key]["extratext"] = i; // the vertex number
            state["vl"][key]["state"] = VERTEX_DEFAULT;
          }

          for (var i = 2; i < internalHeapObject.length; i++) {
            state["el"][i] = {};
            state["el"][i]["vertexA"] = internalHeapObject[
              parent(i)
            ].getSecond();
            state["el"][i]["vertexB"] = internalHeapObject[i].getSecond();
            state["el"][i]["type"] = EDGE_TYPE_UDE;
            state["el"][i]["weight"] = 1;
            state["el"][i]["state"] = EDGE_DEFAULT;
            state["el"][i]["animateHighlighted"] = false;
          }

          return state;
        }

        function populatePseudocode(act) {
          switch (act) {
            case 0: // Insert
              $("#code1").html("A[A.length] = v;");
              $("#code2").html("int i = A.length-1;");
              $("#code3").html(
                "while (i > 1 && A[parent(i)] < A[i]))"
              );
              $("#code4").html("&nbsp&nbspswap(A[i], A[parent(i)]);");

              $("#code6").html("");
              $("#code7").html("");
              break;
            case 1: // ExtractMax
              $("#code1").html("System.out.print(A[0].data+\" \");");
              $("#code2").html("A[0] = A[A.length-1]");
              $("#code3").html("int i = 0; A.length--;");
              $("#code4").html("while (i < A.length){");
              $("#code5").html(
                "&nbsp&nbspif A[i] < (L = i.largerChild())"
              );
              $("#code6").html("&nbsp&nbsp&nbsp&nbspswap(A[i], L);}}");

              break;
            case 2: // HeapSort
              $("#code1").html("for (int i = 0; i < A.length; i++){");
              $("#code2").html("&nbsp&nbspextractMax();");
              $("#code3").html("}i = 0; A.length--;");
              $("#code4").html("");
              $("#code5").html("");
              $("#code6").html("");
              $("#code7").html("");
              break;
            case 3: // Create, O(N log N)
              $("#code1").html("Start from an empty Binary Max Heap");
              $("#code2").html("for (i = 0; i &lt; A.length; i++)");
              $("#code3").html("&nbsp&nbspInsert(A[i])");

              $("#code5").html("");
              $("#code6").html("");
              $("#code7").html("");
              break;
            case 4: // Create, O(N)
              $("#code1").html("The input array A as it is");
              $("#code2").html("for (i = A.length/2; i >= 1; i--)");
              $("#code3").html("&nbsp&nbspshiftDown(i)");

              $("#code5").html("");
              $("#code6").html("");
              $("#code7").html("");
              break;
          }
        }
      };

      // Heap Actions
      var actionsWidth = 150;
      var statusCodetraceWidth = 370;

      var isBuildv1Open = false;
      var isInsertOpen = false;
      var isExtractmaxOpen = false;
      var isHeapsortOpen = false;

      function openBuildv1() {
        if (!isBuildv1Open) {
          $(".buildv1").fadeIn("fast");
          isBuildv1Open = true;
        }
      }

      function closeBuildv1() {
        if (isBuildv1Open) {
          $(".buildv1").fadeOut("fast");
          $("#buildv1-err").html("");
          isBuildv1Open = false;
        }
      }

      function openInsert() {
        if (!isInsertOpen) {
          $(".insert").fadeIn("fast");
          isInsertOpen = true;
        }
      }

      function closeInsert() {
        if (isInsertOpen) {
          $(".insert").fadeOut("fast");
          $("#insert-err").html("");
          isInsertOpen = false;
        }
      }

      function openExtractmax() {
        if (!isExtractmaxOpen) {
          $(".extractmax").fadeIn("fast");
          isExtractmaxOpen = true;
        }
      }

      function closeExtractmax() {
        if (isExtractmaxOpen) {
          $(".extractmax").fadeOut("fast");
          $("#extractmax-err").html("");
          isExtractmaxOpen = false;
        }
      }

      function openHeapsort() {
        if (!isHeapsortOpen) {
          $(".heapsort").fadeIn("fast");
          isHeapsortOpen = true;
        }
      }

      function closeHeapsort() {
        if (isHeapsortOpen) {
          $(".heapsort").fadeOut("fast");
          $("#heapsort-err").html("");
          isHeapsortOpen = false;
        }
      }

      function hideEntireActionsPanel() {
        closeBuildv1();
        closeInsert();
        closeExtractmax();
        closeHeapsort();
        hideActionsPanel();
      }

      // local
      $("#play").hide();
      var heapWidget = new Heap();
      var gw = heapWidget.getGraphWidget();

      $(function () {
        var createHeap = getQueryVariable("create");
        if (createHeap.length > 0) {
          var newHeap = createHeap.split(",");
          if (heapWidget.IsMaxHeap(newHeap))
            // the input parameter is already a max heap
            heapWidget.generate(newHeap);
          // just show
          else buildv2startup(newHeap); // not yet a max heap, build it fast
        }

        $("#buildv1").click(function () {
          closeInsert();
          closeExtractmax();
          closeHeapsort();
          openBuildv1();
        });

        $("#insert").click(function () {
          closeBuildv1();
          closeExtractmax();
          closeHeapsort();
          openInsert();
        });

        $("#extractmax").click(function () {
          closeBuildv1();
          closeInsert();
          closeHeapsort();
          openExtractmax();
        });

        $("#heapsort").click(function () {
          closeBuildv1();
          closeInsert();
          closeExtractmax();
          openHeapsort();
        });

        if (!localStorage.getItem("Heapvisited")) {
          // first visit
          localStorage.setItem("Heapvisited", "true");
          $("#mode-menu a").trigger("click");
        }
      });

      function buildv1() {
        if (isPlaying) stop();
        setTimeout(function () {
          if (
            mode == "exploration" &&
            heapWidget.buildV1($("#arrv1").val().split(","))
          ) {
            $("#current-action").show();
            $("#current-action p").html("创建: " + $("#arrv1").val());
            $("#progress-bar").slider(
              "option",
              "max",
              gw.getTotalIteration() - 1
            );
            triggerRightPanels();
            isPlaying = true; //in viz.js
          }
        }, 500);
      }

      function buildv1Sample() {
        if (isPlaying) stop();
        setTimeout(function () {
          var stringArr =
            "1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31";
          if (
            mode == "exploration" &&
            heapWidget.buildV1(stringArr.split(","))
          ) {
            $("#current-action").show();
            $("#current-action p").html("创建, A = [1,2,3,...,30,31]");
            $("#progress-bar").slider(
              "option",
              "max",
              gw.getTotalIteration() - 1
            );
            triggerRightPanels();
            isPlaying = true; //in viz.js
          }
        }, 500);
      }

      function buildv1Random() {
        if (isPlaying) stop();
        var n = 7 + Math.floor(17 * Math.random());
        var arr = new Array();
        while (n > 0) {
          var newVal = 1 + Math.floor(98 * Math.random());
          if ($.inArray(newVal, arr) == -1) {
            arr.push(newVal);
            n--;
          }
        }
        setTimeout(function () {
          if (mode == "exploration" && heapWidget.buildV1(arr)) {
            $("#current-action").show();
            $("#current-action p").html("创建 " + arr.join(", "));
            $("#progress-bar").slider(
              "option",
              "max",
              gw.getTotalIteration() - 1
            );
            triggerRightPanels();
            isPlaying = true; //in viz.js
          }
        }, 500);
      }

      function insert() {
        if (isPlaying) stop();
        setTimeout(function () {
          if (
            mode == "exploration" &&
            heapWidget.insert(parseInt($("#v").val()), true)
          ) {
            $("#current-action").show();
            $("#current-action p").html("插入 " + $("#v").val());
            $("#progress-bar").slider(
              "option",
              "max",
              gw.getTotalIteration() - 1
            );
            triggerRightPanels();
            isPlaying = true;
            $("#v").val(1 + Math.floor(Math.random() * 98)); // randomized for next click between [1..99}
          }
        }, 500);
      }

      function extractmax() {
        if (isPlaying) stop();
        setTimeout(function () {
          if (mode == "exploration" && heapWidget.extractMax(true)) {
            $("#current-action").show();
            $("#current-action p").html("取出最大值");
            $("#progress-bar").slider(
              "option",
              "max",
              gw.getTotalIteration() - 1
            );
            $("#extractmax-err").html("");
            triggerRightPanels();
            isPlaying = true;
          }
        }, 500);
      }

      function heapsort() {
        if (isPlaying) stop();
        setTimeout(function () {
          if (mode == "exploration" && heapWidget.heapSort()) {
            $("#current-action").show();
            $("#current-action p").html("堆排序");
            $("#progress-bar").slider(
              "option",
              "max",
              gw.getTotalIteration() - 1
            );
            $("#heapsort-err").html("");
            triggerRightPanels();
            isPlaying = true;
          }
        }, 500);
      }
    </script>
  </body>
</html>
